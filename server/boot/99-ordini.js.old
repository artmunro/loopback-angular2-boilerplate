module.exports = function(app, cb) {
    console.log('ordini.js');

    var User = app.models.User;
    var Role = app.models.Role;
    var Ordine = app.models.Ordine;
    var RoleMapping = app.models.RoleMapping;
    var Feedback = app.models.Feedback;

    function die(err) {
        console.error(err);
    }

    function stampaordine(err, ordine) {
        if (err) {
            die(err);
        } else {
            console.log('ORDINE: ' + ordine.id + ' WITH CLIENTE ' +
                    ordine.clienteId + ' AND FORNITORE ' + ordine.fornitoreId);
        }
    }

    User.find({where: {or: [{username: 'ale'}, {username: 'gabriele'}]}}, function(err, users) {
        if (err) return die(err);
        Ordine.create([
            {
                note: 'nota',
                tempoconsegna: 30,
                stato: 2,
                clienteId: users[0].username === 'gabriele' ? users[0].id : users[1].id,
                userfornitoreId: users[0].username === 'ale' ? users[0].id : users[1].id,
                fornitoreId: 1,
                indirizzo: 'Via prova, 4',
                email: users[0].username === 'gabriele' ? users[0].email : users[1].email,
                telefono: users[0].username === 'gabriele' ? users[0].telefono : users[1].telefono,
                totale: 15.10,
                tipo: 0,
                feedback: false,
                speseconsegna: 0,
                piano: '3',
                campanello: 'Antonio Rossi',
            }, {
                note: 'nota',
                dataconsegna: Date.now() + 60 * 60 * 2 * 1000,
                stato: 2,
                clienteId: users[0].username === 'gabriele' ? users[0].id : users[1].id,
                userfornitoreId: users[0].username === 'ale' ? users[0].id : users[1].id,
                fornitoreId: 1,
                indirizzo: 'Via prova, 4',
                email: users[0].username === 'gabriele' ? users[0].email : users[1].email,
                telefono: users[0].username === 'gabriele' ? users[0].telefono : users[1].telefono,
                totale: 15.10,
                tipo: 1,
                feedback: false,
                speseconsegna: 0,
                piano: '5',
                campanello: 'Antonio Bianchi',
            },],
            function(err, ordini) {
                if (err)
                    return die(err);

                var a = [{voto: 3, commento: 'commento', userId: 2, ordineId: 1, fornitoreId: 1}];

                for (var i = 0; i < ordini.length; i++) {
                    var ordine = ordini[i];
                    Ordine.findById(ordine.id, stampaordine);
                }

                Feedback.create(a, function(e, res) {
                    if (e)
                        die(e);

                    console.log(res);
                    cb();
                });
            });
    });
};
